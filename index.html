<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Folder Slideshow (Hardcoded ./photos)</title>
  <style>
    :root{
      --bg: #0b0f14;
      --fg: #e9eef5;
      --muted: #9aa7b1;
      --accent: #5b9dff;
      --accent-2: #00d4ff;
      --card: #121922;
    }
    html, body { height: 100%; }
    body{ margin:0; background: radial-gradient(1200px 800px at 75% 10%, #0f1621 0%, #0b0f14 50%, #090c10 100%); color: var(--fg); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; overflow:hidden; }
    .shell{position:relative; height:100%; width:100%; display:grid; grid-template-rows:auto 1fr auto;}

    .topbar{ display:flex; align-items:center; gap:.75rem; padding: .75rem 1rem; background: rgba(15, 22, 33, .6); backdrop-filter: blur(8px); border-bottom: 1px solid rgba(255,255,255,.06); }
    .title{font-weight:700; letter-spacing:.2px;}
    .spacer{flex:1}
    .hint{color:var(--muted); font-size:.9rem}

    .stage{ position:relative; height:100%; display:grid; place-items:center; }
    .img-wrap{ position:relative; height:100%; width:100%; display:grid; place-items:center;}
    .img{ max-height: 100%; max-width: 100%; object-fit: contain; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.5); transition: opacity .35s ease, transform .4s ease; opacity:0; transform: scale(.985); }
    .img.show{ opacity:1; transform: scale(1); }

    .controls{ position:absolute; inset:auto 0 1.25rem 0; display:flex; align-items:center; gap:.75rem; justify-content:center; }
    .panel{ display:flex; align-items:center; gap:.75rem; padding:.5rem .75rem; border-radius: 999px; background: linear-gradient(180deg, rgba(24,33,48,.85), rgba(14,20,30,.85)); border: 1px solid rgba(255,255,255,.08); box-shadow: 0 6px 24px rgba(0,0,0,.35); }
    .btn{appearance:none; border:0; border-radius:999px; padding:.55rem .8rem; background: #162234; color:var(--fg); display:inline-flex; align-items:center; gap:.5rem; cursor:pointer; font: inherit; font-weight:600; letter-spacing:.2px; transition: transform .04s ease, background .2s ease, opacity .2s ease;}
    .btn:hover{ background:#1e2c44 }
    .btn:active{ transform: translateY(1px) }
    .btn[disabled]{ opacity:.5; cursor:not-allowed }
    .icon{ width:18px; height:18px; display:inline-block }

    .slider{ -webkit-appearance:none; appearance:none; width:160px; height:6px; border-radius:999px; background:#1b2940; outline:none; }
    .slider::-webkit-slider-thumb{ -webkit-appearance:none; appearance:none; width:18px; height:18px; border-radius:50%; background: linear-gradient(135deg, var(--accent), var(--accent-2)); border:none; box-shadow: 0 2px 10px rgba(0,0,0,.4)}
    .slider::-moz-range-thumb{ width:18px; height:18px; border-radius:50%; background: linear-gradient(135deg, var(--accent), var(--accent-2)); border:none; box-shadow: 0 2px 10px rgba(0,0,0,.4) }

    .bottombar{ display:flex; align-items:center; gap:1rem; padding:.6rem .9rem; background: rgba(15, 22, 33, .6); backdrop-filter: blur(8px); border-top: 1px solid rgba(255,255,255,.06); }
    .progress{ position:relative; height:8px; flex:1; background:#101724; border-radius:999px; overflow:hidden; }
    .progress > span{ position:absolute; inset:0 auto 0 0; width:0%; background: linear-gradient(90deg, var(--accent), var(--accent-2)); }

    .drawer{ position:absolute; left:0; right:0; bottom:0; transform: translateY(100%); transition: transform .35s ease; background: rgba(12,18,28,.96); border-top: 1px solid rgba(255,255,255,.08); backdrop-filter: blur(10px); max-height: 40vh; overflow:auto;}
    .drawer.open{ transform: translateY(0); }
    .thumbs{ display:grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap:.5rem; padding: .75rem; }
    .thumb{ width:100%; aspect-ratio: 16/10; object-fit: cover; border-radius: 10px; cursor:pointer; border:2px solid transparent; transition: border-color .2s ease, transform .15s ease; }
    .thumb:hover{ transform: translateY(-2px) }
    .thumb.active{ border-color: var(--accent); }

    .empty{ display:grid; place-items:center; text-align:center; gap:1rem; padding: 2rem; color: var(--muted); }
    .empty .big{ font-size: 1.2rem; color: var(--fg); }
  </style>
</head>
<body>
  <div class="shell">
    <header class="topbar">
      <strong class="title">Slideshow · ./photos</strong>
      <div class="spacer"></div>
      <button id="toggle-fit" class="btn" title="Toggle fit / cover">
        <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M4 5h16a1 1 0 011 1v12a1 1 0 01-1 1H4a1 1 0 01-1-1V6a1 1 0 011-1zm2 2v8h12V7H6z"/></svg>
        <span>Fit</span>
      </button>
      <button id="shuffle" class="btn" title="Shuffle (S)">
        <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M17 3h4v4h-2V5h-2V3zM7 3h2v2H7v2H5V3h2zm12 12h2v6h-6v-2h4v-4zM5 17h2v2h2v2H5v-4zM7 9h2l6 6h-2L7 9zm8-4l4 4h-2l-4-4h2zM5 7h2l6 6H11L5 7z"/></svg>
        <span>Shuffle</span>
      </button>
      <span class="hint">Keys: ←/→ navigate, Space play/pause, F fullscreen, T thumbnails</span>
    </header>

    <main class="stage">
      <div class="img-wrap">
        <img id="viewer" class="img" alt="Slideshow image" />
      </div>
      <div class="controls">
        <div class="panel">
          <button id="prev" class="btn" title="Previous (←)">
            <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
          </button>
          <button id="play" class="btn" title="Play/Pause (Space)">
            <svg id="play-icon" class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
            <svg id="pause-icon" class="icon hidden" viewBox="0 0 24 24" fill="currentColor"><path d="M6 5h4v14H6zm8 0h4v14h-4z"/></svg>
          </button>
          <button id="next" class="btn" title="Next (→)">
            <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"/></svg>
          </button>
          <input id="speed" class="slider" type="range" min="1500" max="10000" value="3500" step="100" title="Autoplay interval (ms)" />
          <button id="thumbs-toggle" class="btn" title="Toggle thumbnails (T)">
            <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M4 4h7v7H4V4zm9 0h7v7h-7V4zM4 13h7v7H4v-7zm9 0h7v7h-7v-7z"/></svg>
            <span>Thumbnails</span>
          </button>
          <button id="full" class="btn" title="Fullscreen (F)">
            <svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M7 14H5v5h5v-2H7v-3zm12 0h-2v3h-3v2h5v-5zM7 7h3V5H5v5h2V7zm10 3h2V5h-5v2h3v3z"/></svg>
          </button>
        </div>
      </div>

      <aside id="drawer" class="drawer">
        <div id="thumbs" class="thumbs"></div>
      </aside>
    </main>

    <footer class="bottombar">
      <div id="status" class="hint">Loading manifest…</div>
      <div class="progress"><span id="bar"></span></div>
    </footer>
  </div>

  <script>
    // === Configuration ===
    const ROOT = './photos/';             // hardcoded folder on your server
    const MANIFEST = ROOT + 'manifest.json'; // generated at deploy time (see instructions)

    const viewer = document.getElementById('viewer');
    const prevBtn = document.getElementById('prev');
    const nextBtn = document.getElementById('next');
    const playBtn = document.getElementById('play');
    const playIcon = document.getElementById('play-icon');
    const pauseIcon = document.getElementById('pause-icon');
    const speed = document.getElementById('speed');
    const statusEl = document.getElementById('status');
    const bar = document.getElementById('bar');
    const thumbsWrap = document.getElementById('thumbs');
    const drawer = document.getElementById('drawer');
    const toggleFit = document.getElementById('toggle-fit');
    const shuffleBtn = document.getElementById('shuffle');
    const thumbsToggle = document.getElementById('thumbs-toggle');
    const fullBtn = document.getElementById('full');

    let files = []; // {name, url}
    let index = 0;
    let timer = null;
    let coverMode = false; // false = contain, true = cover

    async function loadManifest(){
      try{
        const res = await fetch(MANIFEST, {cache:'no-cache'});
        if(!res.ok) throw new Error('Missing manifest.json in ./photos');
        const list = await res.json(); // ["a.jpg","sub/x.png",...]
        if(!Array.isArray(list) || !list.length) throw new Error('manifest.json is empty or invalid');
        files = list.map(name=>({ name, url: ROOT + name }));
        buildThumbs();
        show(0);
        statusEl.textContent = `${files.length} images loaded from ./photos`;
      }catch(err){
        console.error(err);
        statusEl.innerHTML = `❗ ${err.message}.<br/>Create it with a list of files, e.g. <code>[\"1.jpg\", \"album/2.png\"]</code>`;
      }
    }

    function buildThumbs(){
      thumbsWrap.innerHTML = '';
      files.forEach((f,i)=>{
        const img = document.createElement('img');
        img.src = f.url; img.className = 'thumb'; img.title = f.name;
        img.loading = 'lazy';
        img.addEventListener('click', ()=> { show(i); });
        thumbsWrap.appendChild(img);
      });
      markActiveThumb();
    }

    function markActiveThumb(){
      Array.from(thumbsWrap.children).forEach((el,i)=>{
        el.classList.toggle('active', i === index);
      });
    }

    function show(i){
      if(!files.length) return;
      index = (i + files.length) % files.length;
      const current = files[index];
      viewer.classList.remove('show');
      setTimeout(()=>{
        viewer.src = current.url;
        viewer.onload = ()=> viewer.classList.add('show');
      }, 40);
      statusEl.textContent = `${index+1} / ${files.length} — ${current.name}`;
      bar.style.width = `${((index+1)/files.length)*100}%`;
      markActiveThumb();
      const next = new Image();
      next.src = files[(index+1)%files.length].url;
    }

    function next(){ show(index+1); }
    function prev(){ show(index-1); }

    function play(){ if(timer) return; tick(); updatePlayState(); }
    function stop(){ if(timer){ clearTimeout(timer); timer = null; } updatePlayState(); }
    function tick(){ timer = setTimeout(()=>{ next(); tick(); }, Number(speed.value)); }

    function updatePlayState(){
      const playing = !!timer;
      playIcon.classList.toggle('hidden', playing);
      pauseIcon.classList.toggle('hidden', !playing);
      playBtn.title = playing ? 'Pause (Space)' : 'Play (Space)';
    }

    function toggleDrawer(){ drawer.classList.toggle('open'); }

    function toggleFitMode(){
      coverMode = !coverMode;
      viewer.style.objectFit = coverMode ? 'cover' : 'contain';
      toggleFit.querySelector('span').textContent = coverMode ? 'Cover' : 'Fit';
      toggleFit.title = coverMode ? 'Images fill the screen (cover)' : 'Images fit inside (contain)';
    }

    function shuffle(){
      if(!files.length) return;
      for(let i=files.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [files[i], files[j]] = [files[j], files[i]];
      }
      buildThumbs();
      show(0);
    }

    // Wire up UI
    prevBtn.addEventListener('click', prev);
    nextBtn.addEventListener('click', next);
    playBtn.addEventListener('click', ()=> timer?stop():play());
    speed.addEventListener('input', ()=>{ if(timer){ clearTimeout(timer); tick(); } });
    thumbsToggle.addEventListener('click', toggleDrawer);
    toggleFit.addEventListener('click', toggleFitMode);
    shuffleBtn.addEventListener('click', shuffle);
    fullBtn.addEventListener('click', ()=>{
      const el = document.documentElement;
      if(!document.fullscreenElement){ el.requestFullscreen?.(); } else { document.exitFullscreen?.(); }
    });

    window.addEventListener('keydown', (e)=>{
      if(e.key === 'ArrowRight'){ next(); }
      else if(e.key === 'ArrowLeft'){ prev(); }
      else if(e.code === 'Space'){ e.preventDefault(); timer?stop():play(); }
      else if(e.key === 'f' || e.key === 'F'){ fullBtn.click(); }
      else if(e.key === 't' || e.key === 'T'){ toggleDrawer(); }
      else if(e.key === 's' || e.key === 'S'){ shuffle(); }
    });

    // Start
    loadManifest();
  </script>
</body>
</html>
